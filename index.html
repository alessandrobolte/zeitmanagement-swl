<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Zeitmanagement</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üïí</text></svg>">
<style>
:root{
  --bg:#f3f4f6; --panel:#ffffff; --text:#0b1220; --muted:#425066;
  --accent1:#28a745; --accent2:#3b82f6; --radius:12px; --shadow:0 8px 24px rgba(15,23,42,0.06);
}
:root.dark{
  --bg:#0b0b0c; --panel:#0f1112; --text:#e8e8e8; --muted:#9aa0a6;
  --accent1:#ff4d4f; --accent2:#ff902b; --shadow:0 8px 28px rgba(0,0,0,0.6);
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
  background:var(--bg); color:var(--text); padding:20px;
  display:flex; justify-content:center; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
}

.app{width:100%;max-width:1100px;}
header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
h1{margin:0;font-size:1.6rem}
.top-controls{display:flex;gap:10px;align-items:center}
button{
  background:var(--panel); border:1px solid rgba(0,0,0,0.06); color:var(--text);
  padding:8px 12px; border-radius:10px; cursor:pointer; box-shadow:var(--shadow);
}
.small{padding:6px 10px;font-size:0.9rem}
.ghost{background:transparent}
.accent{background:linear-gradient(90deg,var(--accent1),var(--accent2));border:none;color:#fff}
.danger{background:transparent;border:1px solid var(--accent1);color:var(--accent1)}

.top{display:flex;gap:16px;align-items:flex-start}
.cats-panel{flex:1;background:var(--panel);padding:16px;border-radius:var(--radius)}
.timer-panel{width:360px;min-width:260px;background:var(--panel);padding:18px;border-radius:var(--radius);display:flex;flex-direction:column;align-items:center;gap:10px}

.category-list{display:flex;flex-wrap:wrap;gap:10px;margin-top:12px}
.category-card{padding:10px 12px;border-radius:10px;background:linear-gradient(90deg, rgba(0,0,0,0.02), transparent);display:flex;align-items:center;gap:12px;border:1px solid rgba(0,0,0,0.04)}
.category-name{font-weight:700}
.category-meta{font-size:0.85rem;color:var(--muted)}

.time-big{font-size:2.2rem;font-weight:800}
.timer-controls{display:flex;gap:8px;margin-top:8px}
select,input{padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.06);background:transparent;color:var(--text)}
input[type="number"]{width:80px}

.actions-row{display:flex;gap:8px;align-items:center;margin-top:12px}
.centered{display:flex;justify-content:center}

.stats-panel{background:var(--panel);padding:14px;border-radius:var(--radius);margin-top:14px}
.stats-header{display:flex;align-items:center;justify-content:space-between}
.toggle-details{cursor:pointer;color:var(--muted);font-size:0.95rem}
.charts{display:grid;grid-template-columns:1fr 420px;gap:12px;margin-top:12px}
canvas{background:linear-gradient(180deg, rgba(0,0,0,0.02), transparent);border-radius:10px;padding:8px}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{padding:8px 6px;text-align:left;border-bottom:1px dashed rgba(0,0,0,0.06)}
.sessions-list{max-height:220px;overflow:auto}

.modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:flex;align-items:center;justify-content:center;z-index:9999}
.modal{background:var(--panel);padding:18px;border-radius:12px;min-width:320px;max-width:720px}
.form-row{display:flex;gap:8px;margin-bottom:8px}
label{font-size:0.9rem;color:var(--muted);min-width:120px;display:inline-block}

@media (max-width:980px){ .charts{grid-template-columns:1fr} .timer-panel{width:100%} .top{flex-direction:column} }

.tooltip{position:absolute;padding:6px 8px;border-radius:6px;background:var(--panel);border:1px solid rgba(0,0,0,0.06);pointer-events:none;font-size:0.9rem;z-index:10000}

/* Ladeanzeige */
@keyframes pulse {0%{opacity:0.5}50%{opacity:1}100%{opacity:0.5}}
.fade-out{opacity:0;transition:opacity 0.4s ease;}
#toast.show{display:block !important;opacity:1 !important;}
:root:not(.dark) #toast{background:#0077cc;color:white;}
.dark #toast{background:#ff6600;color:#fff;}
</style>
</head>
<body>
<div class="app" id="app">
<header>
<h1>Zeitmanagement</h1>
<div class="top-controls">
<button id="modeToggle" class="small" title="Toggle Theme">‚òÄÔ∏è</button>
<button id="logoutBtn" class="small" title="Logout">üîí Logout</button>
</div>
</header>

<div class="top">
<section class="cats-panel" aria-labelledby="catsTitle">
<div style="display:flex;justify-content:space-between;align-items:center">
  <div style="display:flex;gap:8px;align-items:center">
    <button id="addCategoryBtn" class="accent small" aria-label="Kategorie hinzuf√ºgen">Kategorie hinzuf√ºgen</button>
    <button id="delModeBtn" class="ghost small" aria-pressed="false" title="In den L√∂sch-Modus wechseln">L√∂schen</button>
  </div>
  <div style="text-align:right">
    <div id="catsTitle" style="font-size:0.9rem;color:var(--muted)">Kategorien</div>
  </div>
</div>

<div class="category-list" id="categoryList" aria-live="polite" style="margin-top:12px"></div>

<div class="actions-row" style="margin-top:12px">
  <input type="file" id="importFile" accept=".csv,text/csv" style="display:none" aria-hidden="true" />
  <button id="exportBtn" class="small ghost" title="Export als CSV">Export (CSV)</button>
  <button id="importBtn" class="small ghost" title="Import aus CSV">Import</button>
  <button id="refreshBtn" class="small ghost" title="Daten neu laden">üîÑ Refresh</button>
  <button id="resetBtn" class="small danger" title="Reset Optionen">Reset</button>
</div>

<div class="centered" style="margin-top:10px">
  <button id="forgotBtn" class="accent" style="white-space:nowrap">Zeit stoppen vergessen?</button>
</div>
</section>

<aside class="timer-panel" aria-label="Timer Panel">
<div style="font-size:0.9rem;color:var(--muted)">Aktueller Timer</div>
<div class="time-big" id="activeTimerDisplay">--:--:--</div>
<div style="width:100%;display:flex;gap:8px;align-items:center">
  <label for="activeCategorySelect" style="min-width:110px;color:var(--muted)">Kategorie</label>
  <select id="activeCategorySelect" aria-label="Aktive Kategorie" style="flex:1"></select>
</div>
<div class="timer-controls" style="width:100%;justify-content:center">
  <button id="startBtn" class="small">Start</button>
  <button id="stopBtn" class="small">Stop</button>
</div>
<div style="font-size:0.9rem;color:var(--muted);text-align:center;margin-top:6px">Timer l√§uft auch nach Reload weiter</div>
</aside>
</div>

<section class="stats-panel" id="statsPanel" aria-labelledby="statsTitle">
<div class="stats-header">
<div style="display:flex;gap:10px;align-items:center">
<div id="statsTitle" style="font-weight:700">Statistiken</div>
<div id="rangeButtons" style="display:flex;gap:6px">
  <button class="small" data-range="7">Letzte 7 Tage</button>
  <button class="small" data-range="14">Letzte 14 Tage</button>
  <button class="small" data-range="30">30 Tage</button>
  <button class="small" data-range="all">Gesamt</button>
</div>
</div>
<div class="toggle-details" id="toggleStats">Ausklappen ‚ñæ</div>
</div>

<div id="statsContent" style="display:none;margin-top:10px">
<div style="display:flex;justify-content:space-between;gap:12px;align-items:flex-start;flex-wrap:wrap">
<div style="flex:1;min-width:320px">
<table id="statsTable" aria-label="Statistiken Tabelle">
<thead><tr><th>Kategorie</th><th>Gesamt</th><th>√ò / Tag</th><th>/ Woche</th><th>Sessions</th></tr></thead>
<tbody></tbody>
</table>
</div>
<div style="width:420px">
<canvas id="barChart" width="420" height="220" role="img" aria-label="Balkendiagramm"></canvas>
</div>
</div>

<div style="margin-top:12px">
<div style="font-weight:700;margin-bottom:8px">Verlauf</div>
<canvas id="lineChart" width="980" height="240" style="width:100%" role="img" aria-label="Liniendiagramm"></canvas>
</div>

<div style="margin-top:12px">
<div style="font-weight:700;margin-bottom:8px">Sessions (Details)</div>
<div class="sessions-list"><table id="sessionsTable"><thead>
<tr><th>Kategorie</th><th>Start</th><th>Ende</th><th>Dauer</th><th>Notiz</th></tr>
</thead><tbody></tbody></table></div>
</div>
</div>
</section>

<!-- Modals -->
<div id="modalContainer"></div>

<!-- Toast -->
<div id="toast" class="toast" style="position:fixed;bottom:14px;left:50%;transform:translateX(-50%);padding:10px 16px;border-radius:10px;display:none;opacity:0;transition:opacity 0.4s ease;">Daten neu geladen ‚úÖ</div>

<!-- Ladeanzeige -->
<div id="loader" style="position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.05);font-size:1.2rem;animation:pulse 1.4s infinite;">‚è≥ Lade Daten ‚Ä¶</div>

<script>
// ===== THEME =====
const modeToggle=document.getElementById('modeToggle');
if(localStorage.theme==='dark') document.documentElement.classList.add('dark');
updateThemeIcon();
modeToggle.onclick=()=>{
  document.documentElement.classList.toggle('dark');
  localStorage.theme=document.documentElement.classList.contains('dark')?'dark':'light';
  updateThemeIcon();
}
function updateThemeIcon(){modeToggle.textContent=document.documentElement.classList.contains('dark')?'üåô':'‚òÄÔ∏è'}

// ===== DATA =====
let categories=[],sessions=[],activeTimer=null,activeCategory=null;

// ===== STORAGE =====
function saveData(){localStorage.setItem('categories',JSON.stringify(categories));localStorage.setItem('sessions',JSON.stringify(sessions))}
function loadData(){
  const cat=localStorage.getItem('categories');
  const ses=localStorage.getItem('sessions');
  if(cat) categories=JSON.parse(cat);
  if(ses) sessions=JSON.parse(ses);
  updateUI();
}
function showToast(msg='Daten neu geladen ‚úÖ'){
  const t=document.getElementById('toast'); t.textContent=msg; t.style.display='block';
  setTimeout(()=>{t.style.opacity='1';},50);
  setTimeout(()=>{t.style.opacity='0';setTimeout(()=>{t.style.display='none'},400)},1600);
}

// ===== LOADER =====
function hideLoader(){document.getElementById('loader').classList.add('fade-out');setTimeout(()=>document.getElementById('loader').remove(),500)}

// ===== CATEGORY =====
function updateUI(){
  const list=document.getElementById('categoryList');
  list.innerHTML='';
  const sel=document.getElementById('activeCategorySelect'); sel.innerHTML='';
  categories.forEach((c,i)=>{
    const div=document.createElement('div'); div.className='category-card';
    div.innerHTML=`<div class="category-name">${c.name}</div><div class="category-meta">${c.total||0}h</div>`;
    div.onclick=()=>{if(delModeBtn.getAttribute('aria-pressed')==='true'){categories.splice(i,1);saveData();updateUI();} else {activeCategory=c;}}
    list.appendChild(div);
    const opt=document.createElement('option'); opt.value=i; opt.textContent=c.name; sel.appendChild(opt);
  });
}

// ===== TIMER =====
const activeTimerDisplay=document.getElementById('activeTimerDisplay');
function startTimer(){
  if(activeTimer) return;
  const catIndex=document.getElementById('activeCategorySelect').value;
  activeCategory=categories[catIndex]; if(!activeCategory){alert('Keine Kategorie ausgew√§hlt');return;}
  activeTimer={start:Date.now(),category:activeCategory.name};
}
function stopTimer(){
  if(!activeTimer) return;
  const end=Date.now(),start=activeTimer.start;
  const dur=(end-start)/1000;
  sessions.push({category:activeTimer.category,start,startTime:new Date(start).toISOString(),endTime:new Date(end).toISOString(),duration:dur,note:''});
  activeTimer=null;
  saveData(); updateUI(); showToast('Session gespeichert ‚úÖ');
}
setInterval(()=>{
  if(activeTimer){
    const diff=Date.now()-activeTimer.start;
    const d=new Date(diff); activeTimerDisplay.textContent=`${String(Math.floor(diff/3600000)).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}:${String(d.getSeconds()).padStart(2,'0')}`;
  }
},500);

// ===== CSV =====
document.getElementById('exportBtn').onclick=()=>{
  let csv='Kategorie,Start,Ende,Dauer,Notiz\n';
  sessions.forEach(s=>{csv+=`${s.category},${s.startTime},${s.endTime},${(s.duration/3600).toFixed(2)},${s.note}\n`});
  const blob=new Blob([csv],{type:'text/csv'}); const url=URL.createObjectURL(blob);
  const a=document.createElement('a'); a.href=url; a.download='sessions.csv'; a.click(); URL.revokeObjectURL(url);
}
document.getElementById('importBtn').onclick=()=>document.getElementById('importFile').click();
document.getElementById('importFile').onchange=function(e){
  const file=e.target.files[0]; if(!file) return;
  const reader=new FileReader(); reader.onload=function(ev){
    const lines=ev.target.result.split('\n').slice(1);
    lines.forEach(l=>{
      const [cat,start,end,dur,note]=l.split(',');
      if(cat) sessions.push({category:cat,start:Date.parse(start),startTime:start,endTime:end,duration:parseFloat(dur)*3600,note:note||''});
    }); saveData(); updateUI(); showToast('CSV importiert ‚úÖ');
  }; reader.readAsText(file);
}

// ===== MODALS =====
const modalContainer=document.getElementById('modalContainer');
function showModal(title,content){
  const div=document.createElement('div'); div.className='modal-backdrop';
  div.innerHTML=`<div class="modal"><h3>${title}</h3>${content}<div style="text-align:right;margin-top:12px"><button id="closeModalBtn">Schlie√üen</button></div></div>`;
  modalContainer.appendChild(div);
  div.querySelector('#closeModalBtn').onclick=()=>div.remove();
}

// ===== STATS =====
document.getElementById('toggleStats').onclick=()=>{
  const c=document.getElementById('statsContent'); c.style.display=c.style.display==='none'?'block':'none';
}
function updateStats(){/* Hier k√∂nnen Chart.js Logik oder Canvas Zeichnungen kommen */}

// ===== BUTTONS =====
document.getElementById('refreshBtn').onclick=()=>{loadData(); showToast();}
document.getElementById('resetBtn').onclick=()=>{if(confirm('Alles l√∂schen?')){categories=[];sessions=[];saveData();updateUI();showToast('Reset ‚úÖ');}}
document.getElementById('addCategoryBtn').onclick=()=>{
  const name=prompt('Name der Kategorie'); if(name){categories.push({name,total:0});saveData();updateUI();}}
const delModeBtn=document.getElementById('delModeBtn');
delModeBtn.onclick=()=>{const pressed=delModeBtn.getAttribute('aria-pressed')==='true';delModeBtn.setAttribute('aria-pressed',!pressed);}

// ===== LOGOUT =====
document.getElementById('logoutBtn').onclick = () => {
  if (confirm('Willst du dich wirklich ausloggen?')) {
    // Alle gespeicherten Daten, die beim Login n√∂tig sind, entfernen
    localStorage.removeItem('token'); // falls du einen Login-Token hast
    // Optional: aktive Kategorie oder Session-Daten l√∂schen
    localStorage.removeItem('activeCategory');
    // Zur Login-Seite weiterleiten
    window.location.replace('login.html');

// ===== FORGOT TIMER =====
document.getElementById('forgotBtn').onclick=()=>{showModal('Vergessene Zeit hinzuf√ºgen','<div class="form-row"><label>Dauer (Minuten)</label><input type="number" id="forgotMinutes" min="1" /></div><button id="addForgot" class="accent">Hinzuf√ºgen</button>'); document.getElementById('addForgot').onclick=()=>{
  const mins=parseFloat(document.getElementById('forgotMinutes').value); if(!activeCategory || !mins) return;
  const now=Date.now();
  sessions.push({category:activeCategory.name,start:now-mins*60000,startTime:new Date(now-mins*60000).toISOString(),endTime:new Date(now).toISOString(),duration:mins*60,note:'Manuell nachgetragen'});
  saveData(); updateUI(); modalContainer.innerHTML=''; showToast('Manuell hinzugef√ºgt ‚úÖ');
}}

// ===== INIT =====
loadData();
hideLoader();
</script>
</div>
</body>
</html>

